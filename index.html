<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>YouTube API</title>

  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div id="rez-old"></div>

  <div id="video-container">
    <iframe
      id="iframe-video"
      class="video-frame"
      width="100%" height="100%"
      src="https://www.youtube.com/embed/5IpAd_XwroU?enablejsapi=1&version=3&playerapiid=ytplayer"
      frameborder="0"
      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe>
  </div>

  <div id="rez"></div>

  <script type="text/javascript">

    var tag = document.createElement('script');
    tag.id = 'iframe-demo';
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('iframe-video', {
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
      });
    }

    function getWord(timePlayed) {
      if (timePlayed >= 0 && timePlayed <= 33) {
        return "SHORT";
      }

      if (timePlayed >= 34 && timePlayed <= 66) {
        return "MED";
      }

      if (timePlayed >= 67 && timePlayed <= 100) {
        return "LONG";
      }
    }

    function onPlayerReady(e) {
      document.getElementById("rez").innerHTML = "<p class='ready'>video loaded.</p>";
    }

    function onPlayerStateChange(e) {
      document.getElementById("rez").innerHTML +=
        "<p class='change'>"+
          "<span class='currentTime'>current time: <strong>"+player.getCurrentTime()+"</strong></span>"+
          "<span class='percentage'>percentage: <strong>"+ Math.round(player.getCurrentTime() / player.getDuration() * 100) +"%</strong></span>"+
          "<span class='word'>word: <strong>"+ getWord(Math.round(player.getCurrentTime() / player.getDuration() * 100)) +"</strong></span>"+
        "</p>";
    }

    window.onbeforeunload = function () {
      localStorage.setItem('yt-ended', player.getCurrentTime());
    };
  </script>

</body>
</html>
